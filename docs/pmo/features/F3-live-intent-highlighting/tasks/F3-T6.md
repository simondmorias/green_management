# F3-T6 - Live Intent Highlighting - Fuzzy Matching Layer

## Document Control
**Feature Name & Link:** [Live Intent Highlighting for Conversational Interface](../feature.md)
**Plan Name & Link:** [Implementation Plan](../plan.md)
**Date Created:** September 1, 2025  
**Status:** Not Started

---

## Overview
Add fuzzy matching capabilities using RapidFuzz library to handle misspellings, abbreviations, and variations in entity names with confidence scoring.

---

## Task Requirements

### Task1: RapidFuzz Integration for Fuzzy Matching
**Status:** Not Started

**Description:**
Implement a secondary matching layer using RapidFuzz that processes unmatched text segments to find approximate entity matches. Include confidence scoring and suggestions for low-confidence matches.

**Technical Details:**
- Files to create/modify:
  - `/gain/apps/api/app/services/fuzzy_matcher.py` - Fuzzy matching service
  - `/gain/apps/api/app/services/entity_recognizer.py` - Integrate fuzzy layer
  - `/gain/apps/api/app/schemas/entity_recognition.py` - Add confidence fields
  - `/gain/apps/api/requirements.txt` - Add rapidfuzz dependency
  - `/gain/apps/api/tests/test_fuzzy_matching.py` - Unit tests

- Key implementation points:
  - Use RapidFuzz's process.extract for similarity matching
  - Set confidence threshold at 80% for automatic matching
  - Process only unmatched segments after exact matching
  - Support common variations (plurals, possessives, abbreviations)
  - Calculate Levenshtein distance for confidence scores
  - Return top 3 suggestions for low-confidence matches
  - Optimize with RapidFuzz's C++ backend
  - Cache fuzzy match results for performance
  - Handle edge cases (very short strings, special characters)

**Acceptance Criteria:**
- [ ] Fuzzy matching identifies > 90% of common misspellings
- [ ] Confidence scores accurately reflect match quality
- [ ] Processing adds < 100ms to total latency
- [ ] Suggestions provided for matches below 80% confidence
- [ ] Common abbreviations correctly matched
- [ ] Plurals and possessives handled correctly
- [ ] Cache improves repeated fuzzy match performance
- [ ] Unit tests cover edge cases
- [ ] Integration with exact matcher seamless

## Developer Completion Details

*To be completed by the developer at the end of the task implementation*

### Metadata

- Repo Name: Gain
- Branch Name: [Branch Name]

### Summary of Changes

**Overview**
*Write 500 words to summarise what was done and any issues discovered*

**Testing Notes:**
*Specific test scenarios to verify*

**Definition of Done:**
- [ ] Code implemented and peer reviewed
- [ ] Tests written and passing
- [ ] Documentation updated
- [ ] No linting errors
- [ ] Ready for PR and Approval